---
title: "Species profiles"
author: "Jessica Couture"
date: "June 17, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE,message = FALSE)
```

This document compiles data for and defines species profiles for the fisheries-aquaculture interactions project as part of my dissertation work. Profiles should be based on broad species groups associated with fish farms as described in the literature, and parameters should take on central values of the  various species that make up the species groups.

The $spasm$ package has a function $create\_fish()$ to create the appropriate fish population arguments to feed the simulations. 

* __common_name__ = 'white seabass', # common name to query in fishlife
* __scientific_name__ = "Atractoscion nobilis", # scientific name to query in fishlife
* __linf__ = NA, # species l infinity
* __vbk__ = NA, # k
* __t0__ = -0.1, # time 0
* __cv_len__ = 0.1, # length at age coefficient of variation
* __length_units__ = 'cm', #length units
* __min_age__ = 0, #minimum age
* __max_age__ = NA, # maximum age ('x' from growth equations)
* __time_step__ = 1, # how much time between steps
* __weight_a__ = NA, # length to weight ratio a value (coef)
* __weight_b__ = NA, # length to weight ratio b value (exponent)
* __weight_units__ = 'kg', # weight units
* __length_50_mature__ = NA, # length at 50% maturity
* __length_95_mature__ = NA, # length at 95% maturity
* __delta_mature__ = .1, # difference between length/age_50_mature and length/age_95_mature to calculate 95 from 50
* __age_50_mature__ = NA, # age at 50% mature
* __age_95_mature__ = NA, # age at 95% mature
* __age_mature__ = NA, # possible single value for age at maturity
* __length_mature__ = NA, # possible single value for length at maturity
* __m__ = NA, # natural mortality rate
* __steepness__ = 0.8, # not used in functions below or sim_fishery
* __r0__ = 10000, # virgin recruitment (used in sim_fishery)
* __density_dependence_form__ = 1, # not used in functions below or sim_fishery
* __adult_movement__ = 2, # scales adult movement compared to other individuals (used in sim_fishery)
* __larval_movement__ = 2, # param for adult movement
* __query_fishlife__ = T, #logical, whether to query fishlife for population parameters
* __price__ = 1, # price for catch (used in sim_fishery)
* __price_cv__ = 0, # price parameter (used in sim_fishery)
* __price_ac__ = 0, # price parameter (used in sim_fishery)
* __price_slope__ = 0, # price parameter (used in sim_fishery)
* __sigma_r__ = 0, # recruitment variation param
* __rec_ac__ = 0, # ???
* __cores__ = 4, # ???
* __mat_mode__ = "age", # is maturity based on "age" or "length"? "age" is the default
* __default_wb__ = 2.8, # ???
* __tune_weight__ = FALSE, # ???
* __density_movement_modifier__ = 1, # arg for calc_density_gradient ???
* __linf_buffer__ = 1.2 # l infinity buffer

## Forage fish

Sardine, mullet, species groups listed in the literature. The American Fisheries society also collected forage fish parameter data in an [essay from 2016](https://fisheries.org/2016/01/defining-forage-species-to-prevent-a-management-dilemma/). Compare central statistics from species found in the literature () to the AFS values.

TO DO:

* Pull data for *Sardina pilchardus*, *Sardinella aurita*, and *Mugilidae spp.* from fishbase and calculate averages: 
  + Size
  + Age
  + Habitat
  + Trophic level
* Compare pulled data to AFS data

```{r ffAfsDat}

library(tidyverse)
library(FishLife)
library(spasm)

# AFS data

sizeAFS <- 28 # median max length; range 2.5 - 76
ageAFS <- 10 # median max age; range 2-25
# habitatAFS: 81% pelagic, also reef associated spp (11%) and demersal (8%)
tlAFS <-  3.2 # trophic level for non-juvenile ff, increases to 3.6 whe juveniles are included; range 2.1-4.5


```


### Query FishLife for the forage fish species data
Play around with the data

```{r flFF}

# Get_traits is a spasm function
sarPil<-Get_traits(Genus = "Sardina", Species = "pilchardus") # european pilchard
sarAur<-Get_traits(Genus = "Sardinella", Species = "aurita") # Round sardinella
mugCel<-Get_traits(Genus = "Mugil",Species = "cephalus") # Flathead grey mullet

# messing with fishlife:

ffTaxa = c(Search_species(Genus="Sardina",Species="pilchardus",add_ancestors=FALSE)$match_taxonomy,
           Search_species(Genus="Sardinella",Species="aurita",add_ancestors=FALSE)$match_taxonomy,
           Search_species(Genus="Mugil",Species="cephalus",add_ancestors=FALSE)$match_taxonomy, 
           Search_species(Genus="Mugil",Species="curema",add_ancestors=FALSE)$match_taxonomy, # White/silver mullet
           Search_species(Genus="Mugil",Species="liza",add_ancestors=FALSE)$match_taxonomy, # liza
           Search_species(Genus="Clupea",add_ancestors=FALSE)$match_taxonomy) #herring
Plot_taxa(ffTaxa, mfrow=c(2,2))

```

***

## Predator of forage fish

Bonito, amberjack, tuna, horse mackrel


```{r predDat, echo=FALSE}

```

***

## Demersal fish

Pollock, cod (esp. saithe), haddock, seabream?

***

## crustaceans?

Lobster, rock crab

***

# Test runs

Forage fish: *Sardina pilchardus*

```{r tester}


Spil <- create_fish(scientific_name="Sardina pilchardus")

fshng <- create_fleet(length_50_sel = 0.1 * Spil$linf,
                      initial_effort = 50000,
                      #length_95_sel = 20,
                      fleet_model = "constant-effort",
                      fish = Spil)

#farm <- create_manager(mpa_size = 0.25)


simF<-sim_fishery(fish = Spil,
            fleet = fshng,
            #manager = mngr,
            manager = create_manager(mpa_size = 0.85, year_mpa = 10),
            #num_patches = 3,
            sim_years = 75,
            burn_years = 25,
            time_step = fish$time_step,
            est_msy = FALSE,
            random_mpas = FALSE,
            #min_size = 0.05,
            mpa_habfactor = 1,
            sprinkler = FALSE,
            keep_burn = FALSE)

plot_spasm(simF,type="totals")#, type = "totals", font_size = 12)
## type="patch":colors are different patches (?)
## type="total": sums effort for all patches to calculate total BM, effort, profit/effort, profit
## type="doughnut": animates over the years to give above information for each patch (around doughnut)


```


